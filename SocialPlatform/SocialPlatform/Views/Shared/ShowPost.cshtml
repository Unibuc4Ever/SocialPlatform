@model SocialPlatform.Models.Post
@using SocialPlatform.Models;

@{
	var db = new ApplicationDbContext();
	var userId = User.Identity.GetUserId();
}

@using Microsoft.AspNet.Identity
@{
	ViewBag.Title = "Show";
}


<script>
	function sendLikeForm(postId) {
		$.ajax({
			url: "/Likes/New",
			type: 'POST',
			contentType: 'application/json',
			data: JSON.stringify({
				PostId: postId,
				type: "like"
			}),
			success: function () {
				location.reload();
			},
			error: function (jqXHR, exception) {
				alert('Error message. Failed my Like');
			}
		});
	}

	function sendUnLikeForm(likeId) {
		$.ajax({
			url: "/Likes/Delete",
			type: 'POST',
			contentType: 'application/json',
			data: JSON.stringify({
				LikeId: likeId
			}),
			success: function () {
				location.reload();
			},
			error: function (jqXHR, exception) {
				alert('Error message. Failed my Like');
			}
		});
	}
</script>


<style>
	.demo-card-wide.mdl-card {
		width: 512px;
	}

	.demo-card-wide > .mdl-card__title {
		color: #fff;
		height: 176px;
		background: url("/Content/Images/nature.jpg") center / cover;
	}

	.demo-card-wide > .mdl-card__menu {
		color: #fff;
	}
</style>


<div class="panel-heading"></div>
<div class="panel-body">
	Continut post: <strong>@Model.Content</strong>
	<br />
	<span class="label label-success">@Model.CreatedAt</span>
	<br />
	<p>Created by @Model.User.FirstName</p>
</div>

<div class="demo-card-wide mdl-card mdl-shadow--2dp">
	<div class="mdl-card__title">
		<h2 class="mdl-card__title-text">@Model.Title</h2>
	</div>
	<div class="mdl-card__supporting-text">
		@Model.Content
	</div>
	<div class="mdl-card__actions mdl-card--border" style="display: flex">
		@{
			var Likes = db.Likes.Where(l => (l.UserId == userId && l.PostId == Model.PostId));
			if (Likes.Count() > 0)
			{
				<a onclick="javascript:sendUnLikeForm(@Likes.First().LikeId)" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" style="color: cornflowerblue">
					@Model.Likes.Count() Likes
				</a>
			}
			else
			{
				<a onclick="javascript:sendLikeForm(@Model.PostId)" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" style="color: black">
					@Model.Likes.Count() Likes
				</a>
			}
		}
		<button>idk</button>
	</div>
	<div class="mdl-card__menu">
		<button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect">
			<i class="material-icons">share</i>
		</button>
	</div>
</div>

